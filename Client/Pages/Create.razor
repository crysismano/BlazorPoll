@page "/create"
@inject IPollService PollService
@inject NavigationManager NavigationManager
@using System.Linq

<PollEditor Poll="Poll" Questions="Questions" Answers="Answers" Title="Create" HandleSubmit="HandleSubmit"/>

@code {
    public Poll Poll { get; set; } = new Poll();
    public List<Question> Questions { get; set; } = new List<Question>();
    public List<List<Answer>> Answers { get; set; } = new List<List<Answer>>();

    protected override void OnInitialized()
    {
        Questions.Add(new Question());
        Answers.Add(new List<Answer>());
        Answers[Answers.Count - 1].Add(new Answer());
    }

    async Task HandleSubmit()
    {
        if (Poll.Name is null || Poll.Name == "")
            return;
        List<Question> questions = Questions.Where(x => x.Text != "").ToList();
        if (questions.Count == 0)
            return;
        for (int j = 0; j<questions.Count; j++)
        {
            var answers = new List<Answer>();
            answers = Answers[j].Where(x => x.Text != "").ToList();
            if (answers.Count == 0)
                return;
            questions[j].Answers = answers;
        }
        Poll.Questions = questions;
        await PollService.CreatePoll(Poll);
        NavigationManager.NavigateTo($"/");
    }
}
